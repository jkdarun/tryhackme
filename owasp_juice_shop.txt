OWASP Juice Shop

We will look at OWASP's Top 10 vulnerabilities in web applications.
Need to use Burp Suite
Juice Shop is a large application so we will not be covering every topic from the top 10.

We will, however, cover the following topics:
Injection     ( https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html )
Broken Authentication     ( https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication.html )
Sensitive Data Exposure     ( https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure.html )
Broken Access Control     ( https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html )
Cross-Site Scripting XSS      ( https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS).html )

Let's go on an adventure
find admin's email ID - clicking on the products reveals some information like reviews, can see admin;s email there.
using search box to search for something specific will be added to url 
in this case, seaching for "a" gives 10.10.206.192/#/search?q=a
one person's review says "replicator", searching for it on google tells that its a part of the show Star trek


Inject the juice
types of injection attacks:
1.SQL injection 
2.Command injection
3.Email injection -  allows malicious user to send email without prior authorization by email server. Occur when attacker adds extra data fields which are not interpreted by the server correctly

login credentials entered and submitted, capture in burpsuite (make sure interceptor is on )and can see the data to be sent to the server.
can see {"email":"admin","password":"password"} change it to
{"email":"' or 1=1--","password":"password"}

The character ' will close the brackets in the SQL query
'OR' in a SQL statement will return true if either side of it is true. As 1=1 is always true, the whole statement is true. Thus it will tell the server that the email is valid, and log us into user id 0, which happens to be the administrator account.
The -- character is used in SQL to comment out data, any restrictions on the login will no longer work as they are interpreted as a comment. This is like the # and // comment in python and javascript respectively.
this will login as admin and flag will be shown

now login to bender's account with email bender@juice-sh.op using the same method
in this case, change email to bender@juice-sh.op'--
As the email id is valid (which will return true), we do not need to force it to be true. Thus we are able to use '-- to bypass the login system. Note the 1=1 can be used when the email or username is not known or invalid.
this will show a flag on the website


who broke my lock?
exploiting authentication through flaws

bruteforce admin account password
capture a login request, but instead of sending it through the proxy, we will send it to Intruder. Goto Positions and then select the Clear ยง button. In the password field place two ยง inside the quotes.
For the payload, we will be using the best1050.txt from Seclists. (Which can be installed via: apt-get install seclists)
You can load the list from /usr/share/seclists/Passwords/Common-Credentials/best1050.txt
Once the file is loaded into Burp, start the attack. You will want to filter for the request by status. A failed request will receive a 401 Unauthorized. Whereas a successful request will return a 200 OK. 

reset jim's password
the reset password mechanism can also be exploited! Jim's security question is set to "Your eldest siblings middle name?". In Task 2, we found that Jim might have something to do with Star Trek. Googling "Jim Star Trek" gives us a wiki page for Jame T. Kirk from Star Trek. Looking through the wiki page we find that he has a brother named george samuel kirk. Inputting that into the Forgot Password page allows you to successfully change his password.


ah! dont look
sensitive data exposure

access confidential document
going to about us page and clicking on terms of use link redirects to http://10.10.110.148/ftp/legal.md. Navigating to that /ftp/ directory reveals that it is exposed to the public!
After downloading the acquisitions.md and saving it, navigate to the home page to receive the flag!

log into MC SafeSearch's account
youtube video of a rapper given. he tells his password is "Mr.Noodles" and has replaced some vowels into zeros.

download the backup file
go back to the  http://10.10.110.148/ftp/ folder and try to download package.json.bak. But it seems we are met with a 403 which says that only .md and .pdf files can be downloaded. 
To get around this, we will use a character bypass called "Poison Null Byte". A Poison Null Byte looks like this: %00. Note that we can download it using the url, so we will encode this into a url encoded format. The Poison Null Byte will now look like this: %2500. Adding this and then a .md to the end will bypass the 403 error!
10.10.206.192/ftp/package.json.bak%2500.md
A Poison Null Byte is actually a NULL terminator. By placing a NULL character in the string at a certain byte, the string will tell the server to terminate at that point, nulling the rest of the string. 


who's flying this thing
Modern-day systems will allow for multiple users to have access to different pages. Administrators most commonly use an administration page to edit, add and remove different elements of a website. You might use these when you are building a website with programs such as Weebly or Wix.  
When Broken Access Control exploits or bugs are found, it will be categorised into one of two types:
Horizontal Privilege Escalation - Occurs when a user can perform an action or access data of another user with the same level of permissions.
Vertical Privilege Escalation - Occurs when a user can perform an action or access data of another user with a higher level of permissions.

Broken Access Control
access the admin page
First, we are going to open the Debugger on Firefox. We are then going to refresh the page and look for a javascript file for main-es2015.js
We will then go to that page at: http://10.10.142.173/main-es2015.js
To get this into a format we can read, click the { } button at the bottom. Now search for the term "admin". You will come across a couple of different words containing "admin" but the one we are looking for is "path: administration".
This hints towards a page called "/#/administration" as can be seen by the about path a couple lines below, but going there while not logged in doesn't work. As this is an Administrator page, it makes sense that we need to be in the Admin account in order to view it.
A good way to stop users from accessing this is to only load parts of the application that need to be used by them. This stops sensitive information such as an admin page from been leaked or viewed.
logging in as admin and then visiting http://10.10.142.173/#/admininstration  gives us the flag

View another user's shopping basket
Login to the Admin account and click on 'Your Basket'. Make sure Burp is running so you can capture the request!\
Forward each request until you see: GET /rest/basket/1 HTTP/1.1
Now, we are going to change the number 1 after /basket/ to 2
It will now show you the basket of UserID 2. You can do this for other UserIDs as well, provided that they have one!

Remove all 5-star reviews
Navigate to the  http://10.10.216.102/#/administration page again and click the bin icon next to the review with 5 stars!

